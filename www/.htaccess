# .htaccess minimal pour Drupal sur OVH
# Version simplifiée pour éviter les erreurs 500

# Désactiver les listings de répertoires
Options -Indexes

# Fichier index par défaut
DirectoryIndex index.php index.html

# Protection des fichiers sensibles
<FilesMatch "\.(engine|inc|install|module|profile|po|sh|sql|theme|twig|tpl|xtmpl|yml|lock|json)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order allow,deny
    Deny from all
  </IfModule>
</FilesMatch>

# Encodage UTF-8
AddDefaultCharset utf-8

# Réécriture d'URL pour Drupal
<IfModule mod_rewrite.c>
  RewriteEngine on
  
  # EXCLURE les scripts de maintenance/bypass de la redirection Drupal
  RewriteCond %{REQUEST_URI} !^/bypass-maintenance\.php$
  RewriteCond %{REQUEST_URI} !^/emergency-fix\.php$
  RewriteCond %{REQUEST_URI} !^/diagnostic-simple\.php$
  RewriteCond %{REQUEST_URI} !^/drush-cr\.php$
  RewriteCond %{REQUEST_URI} !^/drush-cr-direct\.php$
  RewriteCond %{REQUEST_URI} !^/exec-drush\.php$
  RewriteCond %{REQUEST_URI} !^/test-simple\.php$
  RewriteCond %{REQUEST_URI} !^/php-info\.php$
  RewriteCond %{REQUEST_URI} !^/clear-cache-web\.php$
  
  # Rediriger tout vers index.php (Clean URLs)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_URI} !=/favicon.ico
  RewriteRule ^ index.php [L]
  
  # Forcer HTTPS (décommentez si besoin)
  # RewriteCond %{HTTPS} off
  # RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# Désactiver le suivi des liens symboliques pour la sécurité
Options -FollowSymLinks

# Types MIME
<IfModule mod_mime.c>
  AddType image/svg+xml svg svgz
  AddEncoding gzip svgz
</IfModule>
